# Tasks for an Ubuntu development machine at The Clymb
- name: "add Percona's key"
  apt_key: keyserver=keys.gnupg.net id=1C4CBDCDCD2EFD2A
  sudo: True
  tags: [mysql]

- name: add repo for Percona
  apt_repository: repo='{{item}} http://repo.percona.com/apt {{ubuntu}} main'
  sudo: True
  tags: [mysql]
  with_items:
    - deb
    - deb-src

- name: install mysql
  apt: pkg={{item}} state=installed
  sudo: True
  tags: [mysql, packages]
  with_items:
    - percona-server-server-5.6
    - libmysqlclient-dev

- name: copy my.cnf
  copy: src=templates/etc/mysql/my.cnf dest=/etc/mysql/my.cnf
  sudo: True
  tags: [mysql]
  notify: [restart MySQL]

- name: download elasticsearch
  get_url: dest=~/src/vendor/es.deb url=https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.1.deb
  tags: [search]

- name: install elasticsearch
  command: dpkg -i /home/{{ansible_ssh_user}}/src/vendor/es.deb creates=/etc/init.d/elasticsearch
  sudo: True
  tags: [search]
  notify: [start ES]

- name: install ruby gem lib dependencies
  apt: pkg={{item}} state=installed
  sudo: True
  with_items:
    - libqt5webkit5-dev # capybara
    - libsqlite3-dev    # mailcatcher gem
    - libtidy-0.99-0    # tidy_ffi
    - libxslt1-dev      # ruby-xslt
    - memcached         # dalli
    - qt5-default       # capybara
    - redis-server      # redis
    - xvfb              # capybara

- name: install base gems
  gem: name={{item}} state=present include_dependencies=True
  notify: [rehash ruby gems]
  with_items:
    - db-rotator
    - mailcatcher
    - zeus
