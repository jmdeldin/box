# vncviewer
- name: add System76 repo
  sudo: True
  tags: [system76]
  apt_repository: repo=ppa:system76-dev/stable

- name: stupid flash workaround for DRM
  sudo: True
  tags: [system76]
  apt_repository: repo=ppa:mjblenner/ppa-hal

- name: install system76 drivers & other GUI software
  apt: pkg={{item}} state=installed
  sudo: True
  tags: [system76, packages]
  with_items:
    - chromium-browser
    - gimp
    - gnome-tweak-tool # set Emacs keybindings + caps lock
    - hal
    - mplayer
    - redshift
    - system76-driver
    - unity-tweak-tool # remove desktop from alt-tab
    - xournal

- name: remove garbage packages
  apt: pkg={{item}} state=absent purge=yes
  sudo: True
  tags: [system76, packages]
  with_items:
    - empathy
    - thunderbird
    - unity-lens-shopping

# SSD optimizations
# https://wiki.debian.org/SSDOptimization
# http://blog.christophersmart.com/2013/06/05/trim-on-lvm-on-luks-on-ssd/
- name: SSD optimization for lvm
  lineinfile: dest=/etc/lvm/lvm.conf state=present backrefs=yes
              regexp="issue_discards = 0" line="issue_discards = 1"
  tags: [ssd]
  sudo: True

- name: SSD optimization for crypttab
  lineinfile: dest=/etc/crypttab state=present backrefs=yes backup=yes
              regexp="(.*) luks" line="\1 luks,discard"
  tags: [ssd]
  sudo: True
  notify: [rebuild boot image]

- cron: name="trim /" hour="10" job="fstrim /"
  sudo: True
  tags: [system76]

- name: Disable bluetooth
  lineinfile: dest=/etc/rc.local state=present line="rfkill block bluetooth"
              insertbefore="exit 0"
  sudo: True
  tags: [system76]
